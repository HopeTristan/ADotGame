<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dot Drift: Local Demo Mode</title>
    <!-- Load Tailwind CSS for modern, responsive styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script type="module">
        // --- LOCAL DEMO MODE ---
        // This version runs 100% locally using localStorage (no internet database needed).
        
        let userId = 'local-player-1'; // Static ID for the local player
        let canvas, ctx;
        let lastUpdateTime = 0;
        const FPS = 60;
        const FRAME_INTERVAL = 1000 / FPS;
        const DOT_RADIUS = 15;
        const PLAYER_COLOR = '#4F46E5'; // Indigo for self

        // Initial Position (Center)
        let myX = 0;
        let myY = 0;
        let canvasWidth = 0;
        let canvasHeight = 0;

        // --- Local Persistence Logic ---
        
        const loadInitialPosition = () => {
            try {
                const storedX = localStorage.getItem('dotDriftX');
                const storedY = localStorage.getItem('dotDriftY');
                if (storedX && storedY) {
                    myX = parseFloat(storedX);
                    myY = parseFloat(storedY);
                }
            } catch (e) {
                console.warn("Could not load position from local storage:", e);
            }
        };

        const updateMyPosition = () => {
            // Limit x/y to be within bounds
            const x = Math.max(DOT_RADIUS, Math.min(myX, canvasWidth - DOT_RADIUS));
            const y = Math.max(DOT_RADIUS, Math.min(myY, canvasHeight - DOT_RADIUS));

            // Save position to local storage for persistence
            localStorage.setItem('dotDriftX', x.toString());
            localStorage.setItem('dotDriftY', y.toString());
        };

        // --- Canvas Drawing Logic ---
        
        const drawGame = () => {
            // Resize canvas to fill container dimensions
            canvasWidth = canvas.clientWidth;
            canvasHeight = canvas.clientHeight;
            if (canvas.width !== canvasWidth) canvas.width = canvasWidth;
            if (canvas.height !== canvasHeight) canvas.height = canvasHeight;
            
            // Clear the canvas
            ctx.clearRect(0, 0, canvasWidth, canvasHeight);

            // Draw the local player dot
            ctx.beginPath();
            ctx.arc(myX, myY, DOT_RADIUS, 0, Math.PI * 2, false);
            ctx.fillStyle = PLAYER_COLOR;
            ctx.shadowColor = PLAYER_COLOR;
            ctx.shadowBlur = 20;
            ctx.fill();
            ctx.closePath();

            // Draw player ID text
            ctx.fillStyle = '#1F2937'; // Dark gray text
            ctx.font = '12px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('YOU (Local Demo)', myX, myY - DOT_RADIUS - 5);
        };

        // Game Loop
        const gameLoop = (timestamp) => {
            const elapsed = timestamp - lastUpdateTime;

            if (elapsed > FRAME_INTERVAL) {
                drawGame();
                lastUpdateTime = timestamp - (elapsed % FRAME_INTERVAL);
            }

            requestAnimationFrame(gameLoop);
        };

        // --- Event Handlers (Input) ---
        
        const handlePointerMove = (event) => {
            // Get coordinates relative to the canvas
            const rect = canvas.getBoundingClientRect();
            const clientX = event.clientX || (event.touches ? event.touches[0].clientX : 0);
            const clientY = event.clientY || (event.touches ? event.touches[0].clientY : 0);

            myX = clientX - rect.left;
            myY = clientY - rect.top;

            // Update the position in the database on move
            updateMyPosition();
        };
        
        // --- Initialization on Window Load ---
        window.onload = () => {
            canvas = document.getElementById('gameCanvas');
            ctx = canvas.getContext('2d');
            
            // Set up event listeners for input
            canvas.addEventListener('mousemove', handlePointerMove);
            canvas.addEventListener('touchmove', handlePointerMove);
            
            // Load position and set center fallback
            canvasWidth = canvas.clientWidth;
            canvasHeight = canvas.clientHeight;
            myX = canvasWidth / 2;
            myY = canvasHeight / 2;
            loadInitialPosition(); 

            // Update UI status
            document.getElementById('player-id').textContent = userId;
            document.getElementById('game-status').classList.remove('bg-yellow-500', 'animate-pulse');
            document.getElementById('game-status').classList.add('bg-green-500');
            document.getElementById('status-message').textContent = "Demo Ready! Moves are saved locally.";
            document.getElementById('player-count').textContent = "1";

            // Start game loop
            requestAnimationFrame(gameLoop);
        };
    </script>
    <style>
        .container-shadow {
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        canvas {
            display: block;
            width: 100%;
            height: 100%;
            cursor: pointer;
            border-radius: 0.5rem;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col items-center justify-center p-4">

    <!-- Header and Status Panel -->
    <div class="w-full max-w-4xl mb-4">
        <h1 class="text-4xl font-extrabold text-gray-800 mb-2">Dot Drift (Local Demo) ðŸ’¾</h1>
        <p class="text-gray-500 mb-6">This version runs entirely on your computer for error-free local use.</p>

        <!-- Status Bar -->
        <div id="game-status" class="flex justify-between items-center p-3 rounded-lg shadow-md bg-yellow-500 text-white animate-pulse transition duration-500">
            <span class="font-bold text-lg">STATUS: <span id="status-message">Loading Local Demo...</span></span>
            <span class="text-sm">Players Online: <span id="player-count" class="font-extrabold text-xl ml-1">...</span></span>
        </div>
    </div>
    
    <!-- Game Canvas and Instructions -->
    <div class="w-full max-w-4xl bg-white container-shadow rounded-xl overflow-hidden p-2" style="height: 60vh;">
        <canvas id="gameCanvas" class="bg-blue-50"></canvas>
    </div>

    <!-- Footer and User Info -->
    <div class="w-full max-w-4xl mt-4 p-4 bg-white rounded-lg shadow-md text-sm text-gray-600">
        <p class="font-semibold text-gray-800 mb-1">Instructions:</p>
        <ul class="list-disc list-inside ml-4">
            <li>Your dot is <span class="text-indigo-600 font-bold">Indigo</span>. Move your mouse or finger inside the box.</li>
            <li>Your dot's position is **saved** in your browser and will be remembered when you reload the page.</li>
            <li>**NOTE:** This is NOT multiplayer. It's a local demo version.</li>
        </ul>
        <div class="mt-3 pt-3 border-t border-gray-200">
            <span class="font-semibold">Player ID:</span> 
            <code id="player-id" class="ml-2 bg-gray-100 p-1 rounded text-xs text-red-700">Loading...</code>
        </div>
    </div>

</body>
</html>
